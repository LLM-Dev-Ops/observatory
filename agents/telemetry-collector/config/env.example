# Telemetry Collector Agent - Environment Configuration Template
#
# Copy this file to .env.local and fill in the actual values
# for your deployment environment.

# ============================================================================
# AGENT CONFIGURATION
# ============================================================================

# Agent identification
AGENT_ID=telemetry-collector-agent
AGENT_VERSION=1.0.0
AGENT_CLASSIFICATION=READ-ONLY

# Deployment environment
ENVIRONMENT=development
# Valid values: development, staging, production

# ============================================================================
# RUVECTOR SERVICE INTEGRATION
# ============================================================================

# RuVector endpoint for distributed coordination and messaging
RUVECTOR_ENDPOINT=https://ruvector-service.internal:443
RUVECTOR_API_KEY=your-ruvector-api-key-here
RUVECTOR_TIMEOUT_MS=5000
RUVECTOR_RETRY_ATTEMPTS=3
RUVECTOR_RETRY_BACKOFF_MS=100

# ============================================================================
# OPENTELEMETRY OBSERVABILITY
# ============================================================================

# Self-observation and tracing configuration
SELF_OBSERVATION_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=https://otel-collector.internal:4317
OTEL_EXPORTER_OTLP_HEADERS=Authorization=Bearer ${OTEL_AUTH_TOKEN}
OTEL_RESOURCE_ATTRIBUTES=service.name=telemetry-collector-agent,service.version=1.0.0,deployment.environment=production

# Trace sampling
OTEL_TRACES_SAMPLER=parentbased_always_on
# Valid samplers: always_on, always_off, parentbased_always_on, parentbased_always_off, jaeger_remote, xray_remote_sampler

# Metrics export
OTEL_METRICS_EXPORTER=otlp
OTEL_LOGS_EXPORTER=otlp

# OpenTelemetry auth token (stored in secrets manager in production)
OTEL_AUTH_TOKEN=your-otel-auth-token-here

# ============================================================================
# TELEMETRY PROCESSING CONFIGURATION
# ============================================================================

# Batch processing settings
BATCH_SIZE=100
BATCH_TIMEOUT_MS=5000
MAX_BATCH_AGE_MS=10000

# Payload limits
MAX_PAYLOAD_SIZE_BYTES=10485760  # 10MB
MAX_EVENTS_PER_SECOND=1000

# ============================================================================
# SCHEMA VALIDATION
# ============================================================================

# Schema registry integration
SCHEMA_VALIDATION_ENABLED=true
SCHEMA_REGISTRY_ENDPOINT=https://schema-registry.internal
SCHEMA_REGISTRY_TIMEOUT_MS=3000
SCHEMA_REGISTRY_CACHE_TTL_SECONDS=3600

# Schema versions
TELEMETRY_EVENT_SCHEMA_VERSION=1.0.0
DECISION_EVENT_SCHEMA_VERSION=1.0.0

# ============================================================================
# RETRY STRATEGY
# ============================================================================

# Retry configuration for transient failures
MAX_RETRIES=3
RETRY_BACKOFF_MS=100
RETRY_MAX_BACKOFF_MS=30000  # 30 seconds
RETRY_BACKOFF_MULTIPLIER=2

# ============================================================================
# LOGGING AND MONITORING
# ============================================================================

# Logging configuration
LOG_LEVEL=info
# Valid levels: trace, debug, info, warn, error, fatal
LOG_FORMAT=json
# Valid formats: json, pretty, text
LOG_DESTINATION=console
# Valid destinations: console, file, cloud-logging

# Log file (if LOG_DESTINATION=file)
LOG_FILE_PATH=/var/log/telemetry-collector.log
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_MAX_AGE_DAYS=7

# Metrics and health checks
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_ENDPOINT=/metrics

HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL_MS=30000

# ============================================================================
# CONSUMER REGISTRATION
# ============================================================================

# Comma-separated list of downstream consumer agents
REGISTERED_CONSUMERS=usage-pattern-agent,failure-classification-agent,health-check-agent,visualization-spec-agent

# Consumer-specific settings
CONSUMER_TIMEOUT_MS=5000
CONSUMER_RETRY_ATTEMPTS=3

# ============================================================================
# DATABASE (if persisting events)
# ============================================================================

# Database connection (optional, for event persistence)
DATABASE_URL=postgres://user:password@localhost:5432/observatory
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_TIMEOUT_MS=5000

# ============================================================================
# CACHING
# ============================================================================

# Cache configuration
CACHE_ENABLED=true
CACHE_TYPE=memory
# Valid types: memory, redis, distributed
CACHE_TTL_SECONDS=3600
CACHE_MAX_SIZE_MB=256

# Redis cache (if CACHE_TYPE=redis or distributed)
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=your-redis-password-here
REDIS_DB=0

# ============================================================================
# SECURITY
# ============================================================================

# API key for ingest endpoint (optional, for authentication)
INGEST_API_KEY=your-ingest-api-key-here

# CORS configuration
CORS_ENABLED=true
CORS_ORIGINS=http://localhost:3000,https://dashboard.internal

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_REQUESTS_PER_HOUR=60000

# ============================================================================
# NODE.JS RUNTIME SETTINGS
# ============================================================================

NODE_ENV=production
NODE_OPTIONS=--max-old-space-size=256

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Enable/disable features
FEATURE_SCHEMA_VALIDATION=true
FEATURE_PAYLOAD_NORMALIZATION=true
FEATURE_EVENT_DEDUPLICATION=true
FEATURE_CONSUMER_DISPATCH=true
FEATURE_SELF_OBSERVATION=true
FEATURE_METRICS_EXPORT=true

# ============================================================================
# DEBUG AND DEVELOPMENT
# ============================================================================

# Debug mode (NEVER set to true in production)
DEBUG=false
DEBUG_NAMESPACE=telemetry-collector-agent:*

# Verbose logging (development only)
VERBOSE=false

# ============================================================================
# DEPLOYMENT-SPECIFIC (Google Cloud Functions)
# ============================================================================

# GCP Configuration
GCP_PROJECT_ID=llm-observatory
GCP_REGION=us-central1
GCP_FUNCTION_NAME=telemetry-collector-agent

# Service account email
SERVICE_ACCOUNT_EMAIL=telemetry-collector@llm-observatory.iam.gserviceaccount.com

# VPC settings
VPC_CONNECTOR=projects/llm-observatory/locations/us-central1/connectors/observatory-vpc
VPC_EGRESS_SETTING=PRIVATE_RANGES_ONLY

# ============================================================================
# SECRETS (DO NOT COMMIT THESE)
# ============================================================================

# These values should be stored in Google Secret Manager or similar
# and injected at runtime. Listed here for reference only.
#
# RUVECTOR_API_KEY=<from-secret-manager>
# OTEL_AUTH_TOKEN=<from-secret-manager>
# DATABASE_URL=<from-secret-manager>
# REDIS_PASSWORD=<from-secret-manager>
# INGEST_API_KEY=<from-secret-manager>
