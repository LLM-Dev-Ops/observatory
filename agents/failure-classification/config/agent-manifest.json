{
  "id": "failure-classification-agent",
  "version": "1.0.0",
  "name": "Failure Classification Agent",
  "description": "Classifies observed failures into deterministic categories to support diagnostics, reporting, and incident analysis.",

  "classification": {
    "type": "READ-ONLY",
    "subtype": "DIAGNOSTIC",
    "enforcement": false,
    "advisory": true
  },

  "purpose": {
    "primary": "Classify telemetry events flagged as failures or errors into deterministic categories",
    "scope": [
      "Consume telemetry events flagged as failures or errors",
      "Apply deterministic classification logic",
      "Assign failure types, causes, and severity classes",
      "Persist classification outcomes for downstream analysis"
    ]
  },

  "inputs": {
    "primary": {
      "schema": "FailureEventSchema",
      "source": "telemetry-collector-agent",
      "format": "JSON",
      "validation": "strict"
    },
    "batch": {
      "schema": "BatchClassificationRequestSchema",
      "maxSize": 1000,
      "format": "JSON"
    }
  },

  "outputs": {
    "classification": {
      "schema": "FailureClassificationSchema",
      "format": "JSON",
      "destination": "ruvector-service"
    },
    "decisionEvent": {
      "schema": "DecisionEventSchema",
      "format": "JSON",
      "destination": "ruvector-service",
      "required": true
    }
  },

  "decisionEvent": {
    "decision_type": "failure_classification",
    "confidence_semantics": "analytical",
    "confidence_description": "Confidence based on signal matching strength, not probabilistic inference",
    "constraints_applied": "ALWAYS_EMPTY",
    "constraints_description": "Read-only agent never applies constraints"
  },

  "responsibilities": [
    "Classify failure events by category (network, provider, request, response, system)",
    "Determine failure severity (critical, high, medium, low, informational)",
    "Identify failure cause (provider, network, client, configuration, resource, policy)",
    "Calculate classification confidence based on signal strength",
    "Emit exactly ONE DecisionEvent per invocation to ruvector-service",
    "Provide advisory recommendations (no action taken)"
  ],

  "nonResponsibilities": [
    "MUST NOT attempt remediation of any kind",
    "MUST NOT correlate incidents across events",
    "MUST NOT escalate events to other systems",
    "MUST NOT trigger alerts directly",
    "MUST NOT modify system state",
    "MUST NOT execute SQL directly (use ruvector-service only)",
    "MUST NOT invoke other agents",
    "MUST NOT influence live execution",
    "MUST NOT trigger orchestration",
    "MUST NOT trigger retries",
    "MUST NOT modify routing or policies",
    "MUST NOT modify thresholds at runtime"
  ],

  "failureModes": [
    {
      "name": "validation_failure",
      "description": "Input event fails schema validation",
      "output": {
        "success": false,
        "error_code": "VALIDATION_ERROR",
        "classification": null
      }
    },
    {
      "name": "classification_failure",
      "description": "Unable to determine classification category",
      "output": {
        "success": true,
        "classification": {
          "category": "unknown",
          "severity": "informational",
          "cause": "unknown",
          "confidence": 0.0
        }
      }
    },
    {
      "name": "ruvector_unavailable",
      "description": "Cannot persist decision event to ruvector-service",
      "output": {
        "success": false,
        "error_code": "PERSISTENCE_ERROR",
        "retry_allowed": true
      }
    },
    {
      "name": "timeout",
      "description": "Classification processing exceeds timeout",
      "output": {
        "success": false,
        "error_code": "TIMEOUT_ERROR",
        "partial_results": true
      }
    },
    {
      "name": "constitutional_violation",
      "description": "Attempted prohibited operation",
      "output": {
        "success": false,
        "error_code": "CONSTITUTIONAL_VIOLATION",
        "operation": "<prohibited_operation>"
      }
    }
  ],

  "cli": {
    "namespace": "failure-classification",
    "commands": [
      {
        "name": "inspect",
        "description": "Inspect a specific classification result",
        "usage": "npx @llm-observatory/cli failure-classification inspect --span-id=<span_id>",
        "parameters": [
          {
            "name": "span-id",
            "required": true,
            "description": "The span ID of the failure event"
          },
          {
            "name": "include-signals",
            "required": false,
            "default": false,
            "description": "Include classification signals in output"
          }
        ]
      },
      {
        "name": "replay",
        "description": "Replay classification for a specific event (determinism verification)",
        "usage": "npx @llm-observatory/cli failure-classification replay --span-id=<span_id>",
        "parameters": [
          {
            "name": "span-id",
            "required": true,
            "description": "The span ID of the failure event to replay"
          },
          {
            "name": "compare",
            "required": false,
            "default": true,
            "description": "Compare with original classification"
          }
        ]
      },
      {
        "name": "analyze",
        "description": "Analyze classification statistics",
        "usage": "npx @llm-observatory/cli failure-classification analyze [--provider=<provider>] [--time-window=<hours>]",
        "parameters": [
          {
            "name": "provider",
            "required": false,
            "description": "Filter by provider"
          },
          {
            "name": "time-window",
            "required": false,
            "default": 24,
            "description": "Time window in hours"
          },
          {
            "name": "group-by",
            "required": false,
            "default": "category",
            "description": "Group by: category, severity, cause, provider, model"
          }
        ]
      },
      {
        "name": "status",
        "description": "Get agent status and health",
        "usage": "npx @llm-observatory/cli failure-classification status [--detailed]",
        "parameters": [
          {
            "name": "detailed",
            "required": false,
            "default": false,
            "description": "Include detailed metrics"
          }
        ]
      }
    ]
  },

  "endpoints": {
    "http": [
      {
        "method": "POST",
        "path": "/classify",
        "description": "Classify a single failure event",
        "input": "FailureEventSchema",
        "output": "FailureClassificationSchema"
      },
      {
        "method": "POST",
        "path": "/classify/batch",
        "description": "Classify a batch of failure events",
        "input": "BatchClassificationRequestSchema",
        "output": "BatchClassificationResultSchema"
      },
      {
        "method": "GET",
        "path": "/health",
        "description": "Health check endpoint",
        "output": "HealthStatus"
      }
    ]
  },

  "deployment": {
    "runtime": "Google Cloud Functions Gen2",
    "platform": "Google Cloud Edge Functions",
    "service": "llm-observatory",
    "stateless": true,
    "persistence": "ruvector-service only"
  },

  "downstreamConsumers": [
    {
      "id": "post-mortem-generator-agent",
      "bundle": "LLM-Analytics-Hub",
      "consumptionType": "query"
    },
    {
      "id": "incident-reporting-systems",
      "bundle": "Governance",
      "consumptionType": "subscription"
    },
    {
      "id": "governance-audit-views",
      "bundle": "Governance",
      "consumptionType": "query"
    }
  ],

  "versioning": {
    "strategy": "semantic",
    "breaking_changes": "major_version_bump",
    "schema_evolution": "backwards_compatible",
    "deprecation_policy": "2_major_versions"
  },

  "metrics": [
    {
      "name": "failure_classifications_total",
      "type": "counter",
      "labels": ["provider", "category", "severity", "cause"]
    },
    {
      "name": "failure_classification_latency_ms",
      "type": "histogram",
      "buckets": [1, 5, 10, 25, 50, 100, 250, 500, 1000]
    },
    {
      "name": "failure_classification_confidence",
      "type": "histogram",
      "buckets": [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
    },
    {
      "name": "failure_classification_errors_total",
      "type": "counter",
      "labels": ["error_type"]
    }
  ],

  "healthChecks": [
    {
      "name": "ruvector-connectivity",
      "endpoint": "https://ruvector-service.internal/health",
      "interval": "30s",
      "timeout": "5s"
    }
  ],

  "sla": {
    "availability": 0.999,
    "latency_p99_ms": 500,
    "latency_p50_ms": 50
  }
}
